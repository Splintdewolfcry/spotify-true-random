const spotifyRandom=(()=>{const e=["playlist-read-private","playlist-read-collaborative","user-modify-playback-state","user-library-read","user-read-playback-state"],t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=new SpotifyWebApi;let n,s;function a(){if(n&&s&&(new Date).getTime()<s)return n;const o=function(){const e={},t=/([^&;=]+)=?([^&;]*)/g,o=window.location.hash.substring(1);let n;for(;n=t.exec(o);)e[n[1]]=decodeURIComponent(n[2]);return e}();if(o.state&&o.access_token&&o.expires_in&&o.state===localStorage.getItem("state"))return localStorage.removeItem("state"),n=o.access_token,s=(new Date).getTime()+o.expires_in,window.location.hash="",n;!function(){const o=Array.apply(null,Array(16)).map(()=>t.charAt(Math.floor(Math.random()*t.length))).join("");localStorage.setItem("state",o),window.location.href="https://accounts.spotify.com/authorize?client_id="+encodeURIComponent("b61d28d1ed4c49e8ba5d2923ed367262")+"&response_type="+encodeURIComponent("token")+"&redirect_uri="+encodeURIComponent("https://tomeraberba.ch/spotify-true-random")+"&state="+encodeURIComponent(o)+"&scope="+encodeURIComponent(e.join(" "))}()}return{token:a,playlists:e=>{o.setAccessToken(a()),o.getUserPlaylists({limit:50},(t,o)=>e(o))},tracks:(e,t)=>{const n=e.split(":")[0],s=e.split(":")[1],c=e.split(":")[2];let i=0;const r=[];!function e(){o.setAccessToken(a()),o.getPlaylistTracks(n,s,{offset:i,limit:100,fields:"items(track(uri))"},(o,n)=>{n.items.map(e=>e.track.uri).forEach(e=>r.push(e)),i+=100,i<c?e():t(r)})}()},library:e=>{o.setAccessToken(a()),o.getMySavedTracks({limit:50},(t,n)=>{const s=n.total;let c=50;const i=n.items.map(e=>e.track.uri);!function t(){o.setAccessToken(a()),o.getMySavedTracks({offset:c,limit:50},(o,n)=>{n.items.map(e=>e.track.uri).forEach(e=>i.push(e)),c+=50,c<s?t():e(i)})}()})},devices:e=>{o.setAccessToken(a()),o.getMyDevices((t,o)=>e(o.devices.filter(e=>!e.is_restricted)))},play:e=>{const t=document.getElementById("devices-select").value;""!==t&&(!function(e){for(let t=e.length-1;t>0;t--){let o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}}(e),o.setAccessToken(a()),o.play({uris:e.slice(0,Math.min(385,e.length)),device_id:t}))},refresh:()=>{spotifyRandom.token()&&(spotifyRandom.playlists(e=>{const t=document.getElementById("playlists-select");for(let e=t.length-1;e>=0;e--)t.remove(e);e.items.forEach(e=>{const o=document.createElement("option");o.text=e.name,o.value=e.owner.id+":"+e.id+":"+e.tracks.total,t.add(o)})}),spotifyRandom.devices(e=>{const t=document.getElementById("devices-select");for(let e=t.length-1;e>=0;e--)t.remove(e);if(0===e.length){const e=document.createElement("option");e.text="Please Open Spotify",e.value="",t.add(e)}else e.forEach(e=>{const o=document.createElement("option");o.text=e.name,o.value=e.id,t.add(o)})}))}}})();document.addEventListener("DOMContentLoaded",()=>spotifyRandom.refresh());